<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Permissionsdispatcher by hotchemi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Permissionsdispatcher</h1>
      <h2 class="project-tagline">Provides simple annotation-based API to handle runtime permissions in   Android M.</h2>
      <a href="https://github.com/hotchemi/PermissionsDispatcher" class="btn">View on GitHub</a>
      <a href="https://github.com/hotchemi/PermissionsDispatcher/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/hotchemi/PermissionsDispatcher/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="permissionsdispatcher" class="anchor" href="#permissionsdispatcher" aria-hidden="true"><span class="octicon octicon-link"></span></a>PermissionsDispatcher</h1>

<p><a href="https://travis-ci.org/hotchemi/PermissionsDispatcher"><img src="https://travis-ci.org/hotchemi/PermissionsDispatcher.svg" alt="Build Status"></a>
<a href="https://bintray.com/hotchemi/maven/permissionsdispatcher/_latestVersion"> <img src="https://api.bintray.com/packages/hotchemi/maven/permissionsdispatcher/images/download.svg" alt="Download"> </a>
<a href="https://android-arsenal.com/details/1/2316"><img src="https://img.shields.io/badge/Android%20Arsenal-PermissionsDispatcher-green.svg?style=flat" alt="Android Arsenal"></a></p>

<p>PermissionsDispatcher provides simple annotation-based API to handle runtime permissions in Android M.</p>

<p><a href="https://developer.android.com/preview/features/runtime-permissions.html">Runtime permissions</a> is so great for users but also the hell for developers. Actually I don't want to write such a complicated <a href="https://github.com/googlesamples/android-RuntimePermissions/blob/master/Application/src/main/java/com/example/android/system/runtimepermissions/MainActivity.java">code</a> anymore.</p>

<p>You can be released from the burden that writing a bunch of check statements whether a permission have been granted or not. </p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Here's a minimum example that you register <code>MainActivity</code> which requires <code>Manifest.permission.CAMERA</code>.</p>

<h3>
<a id="1-attach-annotations" class="anchor" href="#1-attach-annotations" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Attach annotations</h3>

<p>There are only 3 annotations.</p>

<ul>
<li>
<code>@RuntimePermissions</code>: [Must] Register an Activity or Fragment to handle permissions.</li>
<li>
<code>@NeedsPermission</code>: [Must] Register a method which the permission is needed.</li>
<li>
<code>@ShowsRationale</code>: [Option] Register a method which explains why the permission is needed. Actually an annotated method is called when <code>shouldShowRequestPermissionRationale</code> returns true or when uer deny a permission.</li>
</ul>

<blockquote>
<p>NOTE: Annotated methods must be package private or above.</p>
</blockquote>

<div class="highlight highlight-java"><pre>@<span class="pl-smi">RuntimePermissions</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MainActivity</span> <span class="pl-k">extends</span> <span class="pl-e">Activity</span> {

    <span class="pl-k">@NeedsPermission</span>(<span class="pl-smi">Manifest</span><span class="pl-k">.</span><span class="pl-smi">permission<span class="pl-k">.</span>CAMERA</span>)
    <span class="pl-k">void</span> <span class="pl-en">showCamera</span>() {
        getSupportFragmentManager()<span class="pl-k">.</span>beginTransaction()
                .replace(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>sample_content_fragment, <span class="pl-smi">CameraPreviewFragment</span><span class="pl-k">.</span>newInstance())
                .addToBackStack(<span class="pl-s"><span class="pl-pds">"</span>camera<span class="pl-pds">"</span></span>)
                .commitAllowingStateLoss();
    }

    <span class="pl-c">// this is option</span>
    <span class="pl-k">@ShowsRationale</span>(<span class="pl-smi">Manifest</span><span class="pl-k">.</span><span class="pl-smi">permission<span class="pl-k">.</span>CAMERA</span>)
    <span class="pl-k">void</span> <span class="pl-en">showRationaleForCamera</span>() {
        <span class="pl-smi">Toast</span><span class="pl-k">.</span>makeText(<span class="pl-v">this</span>, <span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>permission_camera_rationale, <span class="pl-smi">Toast</span><span class="pl-c1"><span class="pl-k">.</span>LENGTH_SHORT</span>)<span class="pl-k">.</span>show();
    }
}</pre></div>

<h3>
<a id="2-delegate-to-generated-class" class="anchor" href="#2-delegate-to-generated-class" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Delegate to generated class</h3>

<p>Now you can use the class that generated by annotation processor.</p>

<p>In this case the name is <code>MainActivityPermissionsDispatcher</code>.</p>

<p>It has methods ends with <code>WithCheck</code> and <code>onRequestPermissionsResult</code>.</p>

<p>Only you have to do is delegating the work to them.</p>

<div class="highlight highlight-java"><pre>@<span class="pl-smi">Override</span>
<span class="pl-k">protected</span> <span class="pl-k">void</span> onCreate(<span class="pl-smi">Bundle</span> savedInstanceState) {
    <span class="pl-v">super</span><span class="pl-k">.</span>onCreate(savedInstanceState);
    setContentView(<span class="pl-smi">R</span><span class="pl-k">.</span>layout<span class="pl-k">.</span>activity_main);
    <span class="pl-smi">Button</span> cameraButton <span class="pl-k">=</span> (<span class="pl-smi">Button</span>) findViewById(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_camera);
    cameraButton<span class="pl-k">.</span>setOnClickListener(<span class="pl-v">this</span>);
    <span class="pl-smi">Button</span> contactsButton <span class="pl-k">=</span> (<span class="pl-smi">Button</span>) findViewById(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_contacts);
    contactsButton<span class="pl-k">.</span>setOnClickListener(<span class="pl-v">this</span>);
}

@<span class="pl-smi">Override</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onClick(<span class="pl-smi">View</span> v) {
    <span class="pl-k">switch</span> (v<span class="pl-k">.</span>getId()) {
        <span class="pl-k">case</span> <span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_camera<span class="pl-k">:</span>
            <span class="pl-c">// NOTE: delegate the permission handling to generated method</span>
            <span class="pl-smi">MainActivityPermissionsDispatcher</span><span class="pl-k">.</span>showCameraWithCheck(<span class="pl-v">this</span>);
            <span class="pl-k">break</span>;
        <span class="pl-k">case</span> <span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_contacts<span class="pl-k">:</span>
            <span class="pl-c">// NOTE: delegate the permission handling to generated method</span>
            <span class="pl-smi">MainActivityPermissionsDispatcher</span><span class="pl-k">.</span>showContactsWithCheck(<span class="pl-v">this</span>);
            <span class="pl-k">break</span>;
    }
}

@<span class="pl-smi">Override</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onRequestPermissionsResult(<span class="pl-k">int</span> requestCode, <span class="pl-k">String</span>[] permissions, <span class="pl-k">int</span>[] grantResults) {
    <span class="pl-c">// NOTE: delegate the permission handling to generated method</span>
    <span class="pl-smi">MainActivityPermissionsDispatcher</span>.
            onRequestPermissionsResult(<span class="pl-v">this</span>, requestCode, permissions, grantResults);
}</pre></div>

<p>If you want to know more detail, please check the <a href="https://github.com/hotchemi/PermissionsDispatcher/tree/master/permissionsdispatcher-sample">sample</a> and <a href="https://gist.github.com/hotchemi/5dc89c02399c2419fab7">generated class</a>.</p>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h2>

<p>Add to your project <code>build.gradle</code> file:</p>

<div class="highlight highlight-groovy"><pre>buildscript {
  dependencies {
    classpath <span class="pl-s"><span class="pl-pds">'</span>com.neenbedankt.gradle.plugins:android-apt:1.4<span class="pl-pds">'</span></span>
  }
}

apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>android-apt<span class="pl-pds">'</span></span>

dependencies {
  compile <span class="pl-s"><span class="pl-pds">'</span>com.github.hotchemi:permissionsdispatcher:1.0.0<span class="pl-pds">'</span></span>
  apt <span class="pl-s"><span class="pl-pds">'</span>com.github.hotchemi:permissionsdispatcher-processor:1.0.0<span class="pl-pds">'</span></span>
}</pre></div>

<h2>
<a id="support" class="anchor" href="#support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support</h2>

<p>PermissionsDispatcher supports API level over 4, and using support v4 rev.23.</p>

<h2>
<a id="proguard" class="anchor" href="#proguard" aria-hidden="true"><span class="octicon octicon-link"></span></a>ProGuard</h2>

<pre><code>-dontwarn permissions.dispatcher.processor.**
-keep class permissions.dispatcher.** { *; }
-keep class **PermissionsDispatcher { *; }
-keepclasseswithmembernames class * {
    @permissions.dispatcher.* &lt;methods&gt;;
}
</code></pre>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<pre><code>Copyright 2015 Shintaro Katafuchi

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/hotchemi/PermissionsDispatcher">Permissionsdispatcher</a> is maintained by <a href="https://github.com/hotchemi">hotchemi</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
