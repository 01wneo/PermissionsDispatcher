<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Permissionsdispatcher by hotchemi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Permissionsdispatcher</h1>
      <h2 class="project-tagline">Provides simple annotation-based API to handle runtime permissions in   Android M.</h2>
      <a href="https://github.com/hotchemi/PermissionsDispatcher" class="btn">View on GitHub</a>
      <a href="https://github.com/hotchemi/PermissionsDispatcher/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/hotchemi/PermissionsDispatcher/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="permissionsdispatcher" class="anchor" href="#permissionsdispatcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PermissionsDispatcher</h1>

<p><a href="https://travis-ci.org/hotchemi/PermissionsDispatcher"><img src="https://travis-ci.org/hotchemi/PermissionsDispatcher.svg?branch=master" alt="Build Status"></a></p>

<p><img src="https://raw.githubusercontent.com/hotchemi/PermissionsDispatcher/master/art/logo.png" alt="image"></p>

<p>PermissionsDispatcher provides a simple annotation-based API to handle runtime permissions in Android Marshmallow.
<a href="https://developer.android.com/preview/features/runtime-permissions.html">Runtime permissions</a> are great for users, but can be tedious to implement correctly for developers, requiring a lot of boilerplate code. This library lifts the burden that comes with writing a bunch of check statements whether a permission has been granted or not from you, in order to keep your code clean and safe. The library is 100% reflection-free.</p>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download</h2>

<p>This library is only compatible with Gradle-based builds.</p>

<p>To add it to your project, include the following in your <strong>project</strong> <code>build.gradle</code> file:</p>

<div class="highlight highlight-source-groovy"><pre>buildscript {
  dependencies {
    classpath <span class="pl-s"><span class="pl-pds">'</span>com.neenbedankt.gradle.plugins:android-apt:1.8<span class="pl-pds">'</span></span>
  }
}</pre></div>

<p>And on your <strong>app module</strong> <code>build.gradle</code>:</p>

<p><code>${latest.version}</code> is <a href="https://bintray.com/hotchemi/maven/permissionsdispatcher/_latestVersion"><img src="https://api.bintray.com/packages/hotchemi/maven/permissionsdispatcher/images/download.svg" alt="Download"></a></p>

<div class="highlight highlight-source-groovy"><pre>apply <span class="pl-c1">plugin</span>: <span class="pl-s"><span class="pl-pds">'</span>android-apt<span class="pl-pds">'</span></span>

dependencies {
  compile <span class="pl-s"><span class="pl-pds">'</span>com.github.hotchemi:permissionsdispatcher:${latest.version}<span class="pl-pds">'</span></span>
  apt <span class="pl-s"><span class="pl-pds">'</span>com.github.hotchemi:permissionsdispatcher-processor:${latest.version}<span class="pl-pds">'</span></span>
}</pre></div>

<h3>
<a id="note" class="anchor" href="#note" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Note</h3>

<p>PermissionsDispatcher depends on the <code>support-v4</code> library by default, in order to be able to use some permission compat classes.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>Here's a minimum example, in which we register a <code>MainActivity</code> which requires <code>Manifest.permission.CAMERA</code>.</p>

<h3>
<a id="1-attach-annotations" class="anchor" href="#1-attach-annotations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Attach annotations</h3>

<p>PermissionsDispatcher introduces only a few annotations, keeping its general API concise:</p>

<table>
<thead>
<tr>
<th>Annotation</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@RuntimePermissions</code></td>
<td><strong>✓</strong></td>
<td>Register an <code>Activity</code> or <code>Fragment</code> to handle permissions</td>
</tr>
<tr>
<td><code>@NeedsPermission</code></td>
<td><strong>✓</strong></td>
<td>Annotate a method which performs the action that requires one or more permissions</td>
</tr>
<tr>
<td><code>@OnShowRationale</code></td>
<td></td>
<td>Annotate a method which explains why the permission/s is/are needed. It passes in a <code>PermissionRequest</code> object which can be used to continue or abort the current permission request upon user input</td>
</tr>
<tr>
<td><code>@OnPermissionDenied</code></td>
<td></td>
<td>Annotate a method which is invoked if the user doesn't grant the permissions</td>
</tr>
<tr>
<td><code>@OnNeverAskAgain</code></td>
<td></td>
<td>Annotate a method which is invoked if the user chose to have the device "never ask again" about a permission</td>
</tr>
</tbody>
</table>

<blockquote>
<p>NOTE: Annotated methods must not be <code>private</code>.</p>
</blockquote>

<div class="highlight highlight-source-java"><pre>@<span class="pl-smi">RuntimePermissions</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MainActivity</span> <span class="pl-k">extends</span> <span class="pl-e">AppCompatActivity</span> {

    <span class="pl-k">@NeedsPermission</span>(<span class="pl-smi">Manifest</span><span class="pl-k">.</span><span class="pl-smi">permission<span class="pl-k">.</span>CAMERA</span>)
    <span class="pl-k">void</span> <span class="pl-en">showCamera</span>() {
        getSupportFragmentManager()<span class="pl-k">.</span>beginTransaction()
                .replace(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>sample_content_fragment, <span class="pl-smi">CameraPreviewFragment</span><span class="pl-k">.</span>newInstance())
                .addToBackStack(<span class="pl-s"><span class="pl-pds">"</span>camera<span class="pl-pds">"</span></span>)
                .commitAllowingStateLoss();
    }

    <span class="pl-k">@OnShowRationale</span>(<span class="pl-smi">Manifest</span><span class="pl-k">.</span><span class="pl-smi">permission<span class="pl-k">.</span>CAMERA</span>)
    <span class="pl-k">void</span> <span class="pl-en">showRationaleForCamera</span>(<span class="pl-smi">PermissionRequest</span> <span class="pl-v">request</span>) {
        <span class="pl-k">new</span> <span class="pl-smi">AlertDialog</span>.<span class="pl-smi">Builder</span>(<span class="pl-v">this</span>)
            .setMessage(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>permission_camera_rationale)
            .setPositiveButton(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>button_allow, (dialog, button) <span class="pl-k">-</span><span class="pl-k">&gt;</span> request<span class="pl-k">.</span>proceed())
            .setNegativeButton(<span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>button_deny, (dialog, button) <span class="pl-k">-</span><span class="pl-k">&gt;</span> request<span class="pl-k">.</span>cancel())
            .show();
    }

    <span class="pl-k">@OnPermissionDenied</span>(<span class="pl-smi">Manifest</span><span class="pl-k">.</span><span class="pl-smi">permission<span class="pl-k">.</span>CAMERA</span>)
    <span class="pl-k">void</span> <span class="pl-en">showDeniedForCamera</span>() {
        <span class="pl-smi">Toast</span><span class="pl-k">.</span>makeText(<span class="pl-v">this</span>, <span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>permission_camera_denied, <span class="pl-smi">Toast</span><span class="pl-c1"><span class="pl-k">.</span>LENGTH_SHORT</span>)<span class="pl-k">.</span>show();
    }

    <span class="pl-k">@OnNeverAskAgain</span>(<span class="pl-smi">Manifest</span><span class="pl-k">.</span><span class="pl-smi">permission<span class="pl-k">.</span>CAMERA</span>)
    <span class="pl-k">void</span> <span class="pl-en">showNeverAskForCamera</span>() {
        <span class="pl-smi">Toast</span><span class="pl-k">.</span>makeText(<span class="pl-v">this</span>, <span class="pl-smi">R</span><span class="pl-k">.</span>string<span class="pl-k">.</span>permission_camera_neverask, <span class="pl-smi">Toast</span><span class="pl-c1"><span class="pl-k">.</span>LENGTH_SHORT</span>)<span class="pl-k">.</span>show();
    }
}</pre></div>

<h3>
<a id="2-delegate-to-generated-class" class="anchor" href="#2-delegate-to-generated-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Delegate to generated class</h3>

<p>Upon compilation, PermissionsDispatcher generates a class for <code>MainActivity</code> (suffixed with <code>PermissionsDispatcher</code>), which you can use to safely access these permission-protected methods. The only step you have to do is delegating the work to this helper class:</p>

<div class="highlight highlight-source-java"><pre>@<span class="pl-smi">Override</span>
<span class="pl-k">protected</span> <span class="pl-k">void</span> onCreate(<span class="pl-smi">Bundle</span> savedInstanceState) {
    <span class="pl-v">super</span><span class="pl-k">.</span>onCreate(savedInstanceState);
    setContentView(<span class="pl-smi">R</span><span class="pl-k">.</span>layout<span class="pl-k">.</span>activity_main);
    findViewById(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_camera)<span class="pl-k">.</span>setOnClickListener(<span class="pl-v">this</span>);
    findViewById(<span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_contacts)<span class="pl-k">.</span>setOnClickListener(<span class="pl-v">this</span>);
}

@<span class="pl-smi">Override</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onClick(<span class="pl-smi">View</span> v) {
    <span class="pl-k">switch</span> (v<span class="pl-k">.</span>getId()) {
        <span class="pl-k">case</span> <span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_camera<span class="pl-k">:</span>
            <span class="pl-c">// NOTE: delegate the permission handling to generated method</span>
            <span class="pl-smi">MainActivityPermissionsDispatcher</span><span class="pl-k">.</span>showCameraWithCheck(<span class="pl-v">this</span>);
            <span class="pl-k">break</span>;
        <span class="pl-k">case</span> <span class="pl-smi">R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>button_contacts<span class="pl-k">:</span>
            <span class="pl-c">// NOTE: delegate the permission handling to generated method</span>
            <span class="pl-smi">MainActivityPermissionsDispatcher</span><span class="pl-k">.</span>showContactsWithCheck(<span class="pl-v">this</span>);
            <span class="pl-k">break</span>;
    }
}

@<span class="pl-smi">Override</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onRequestPermissionsResult(<span class="pl-k">int</span> requestCode, <span class="pl-k">String</span>[] permissions, <span class="pl-k">int</span>[] grantResults) {
    <span class="pl-v">super</span><span class="pl-k">.</span>onRequestPermissionsResult(requestCode, permissions, grantResults);
    <span class="pl-c">// NOTE: delegate the permission handling to generated method</span>
    <span class="pl-smi">MainActivityPermissionsDispatcher</span><span class="pl-k">.</span>onRequestPermissionsResult(<span class="pl-v">this</span>, requestCode, grantResults);
}</pre></div>

<p>Check out the <a href="https://github.com/hotchemi/PermissionsDispatcher/tree/master/sample">sample</a> and <a href="https://gist.github.com/aurae/7821f3a2da098b949f7b">generated class</a> for more details.</p>

<h2>
<a id="support" class="anchor" href="#support" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support</h2>

<p>PermissionsDispatcher is supported on <strong>API levels 4 and up</strong>, with which you get support for annotating <code>android.app.Activity</code> and <code>android.support.v4.app.Fragment</code> sub-classes out of the box.</p>

<p>In case you rely on <code>android.app.Fragment</code> in your app, you can use these with PermissionsDispatcher as well! Simply add a dependency on the <code>support-v13</code> library alongside PermissionsDispatcher in your project, and it will enable support for native fragments.</p>

<h3>
<a id="for-1x-user" class="anchor" href="#for-1x-user" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>For 1.x user</h3>

<ul>
<li><a href="https://github.com/hotchemi/PermissionsDispatcher/wiki/Migrating-to-2.x">Migrating to 2.x</a></li>
</ul>

<h3>
<a id="for-japanese" class="anchor" href="#for-japanese" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>For Japanese</h3>

<ul>
<li><a href="http://qiita.com/kazy/items/0ded30d80cef9df54c98">Android - 5分で対応するMパーミッション - Qiita</a></li>
</ul>

<h2>
<a id="licence" class="anchor" href="#licence" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Licence</h2>

<pre><code>Copyright 2016 Shintaro Katafuchi, Marcel Schnelle

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/hotchemi/PermissionsDispatcher">Permissionsdispatcher</a> is maintained by <a href="https://github.com/hotchemi">hotchemi</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
